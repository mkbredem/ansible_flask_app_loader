---

- name: Play to setup postgres server
  hosts: database_servers
  vars:
    firewall_services:
      - postgress
    firewall_ports:
      - 5432
          
  tasks:
    - debug:
        msg: "Start postgress server setup"

    - name: Install Firewalld
      yum:
        name: firewalld
        state: latest
   
    - name: Start firewalld
      service:
        name: firewalld
        enabled: yes
        state: started

    - name: Open service port
      when: firewall_services is defined
      firewalld:
        service: "{{ __service }}"
        state: enabled
        immediate: true
        permanent: true
      loop: "{{ firewall_services }}"
      loop_control:
        loop_var: __service

    - name: Open tcp port
      when: firewall_tcp_ports is defined
      firewalld:
        port: "{{ __tcp_port }}/tcp"
        permanent: yes
        immediate: yes
        state: enabled
      loop: "{{ firewall_tcp_ports }}"
      loop_control:
        loop_var: __tcp_port


#    - name: Setup firewall
#      include_role:
#        name: final_firewall
#      vars:
#        firewall_services:
#          - postgress
#        firewall_ports:
#          - 5432

    - name: Setup mysql server
      include_role:
        name: final_postgres10

    - debug:
        msg: "Finished postgres server setup"

